<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ANOMAAH â€” Sign In</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    *{box-sizing:border-box}
    body{font-family:'Inter',system-ui,-apple-system,sans-serif;-webkit-font-smoothing:antialiased;background:#0f172a;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    input{-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:16px}
    button{min-height:44px;cursor:pointer}
    .tab-btn{flex:1;padding:10px 8px;border-radius:10px;font-size:.8rem;font-weight:600;border:none;transition:background .15s,color .15s;cursor:pointer}
    .tab-btn.active{background:#fff;color:#0f172a;box-shadow:0 2px 8px rgba(0,0,0,.15)}
    .tab-btn:not(.active){background:transparent;color:#94a3b8}
    .tab-btn:not(.active):hover{color:#cbd5e1}
    .role-badge{display:inline-flex;align-items:center;gap:6px;font-size:.7rem;font-weight:700;padding:4px 10px;border-radius:20px;margin-bottom:8px}
  </style>
</head>
<body>
  <div style="width:100%;max-width:420px">

    <!-- Logo -->
    <div class="text-center mb-6">
      <a href="/" style="text-decoration:none;display:inline-flex;align-items:center;gap:10px;justify-content:center">
        <div style="width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,#f97316,#ea580c);display:flex;align-items:center;justify-content:center">
          <span class="text-white font-black text-lg">A</span>
        </div>
        <span class="text-white font-black text-2xl tracking-wide">ANOMAAH</span>
      </a>
      <p class="text-sm mt-2" style="color:#64748b">Sign in to your dashboard</p>
    </div>

    <!-- Card -->
    <div style="background:#1e293b;border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:28px 24px">

      <!-- Role tabs -->
      <div style="background:rgba(0,0,0,.3);border-radius:12px;padding:4px;display:flex;gap:2px;margin-bottom:24px" id="tabBar">
        <button class="tab-btn active" data-role="merchant" onclick="switchTab(this)">ğŸª Merchant</button>
        <button class="tab-btn" data-role="company" onclick="switchTab(this)">ğŸš› Company</button>
        <button class="tab-btn" data-role="superadmin" onclick="switchTab(this)">ğŸ›¡ï¸ Admin</button>
      </div>

      <!-- Role badge -->
      <div id="roleBadge" class="role-badge mb-4" style="background:rgba(16,185,129,.15);color:#34d399;border:1px solid rgba(16,185,129,.3)">
        <span id="roleEmoji">ğŸª</span> <span id="roleLabel">Merchant Portal</span>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1.5" style="color:#cbd5e1">Username</label>
          <input id="username" placeholder="Enter your username"
            style="width:100%;background:#0f172a;border:1.5px solid rgba(255,255,255,.15);border-radius:10px;padding:14px 16px;color:#f1f5f9;font-size:16px;transition:border-color .15s"
            onfocus="this.style.borderColor='#f97316'" onblur="this.style.borderColor='rgba(255,255,255,.15)'" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1.5" style="color:#cbd5e1">Password</label>
          <input id="password" type="password" placeholder="Enter your password"
            style="width:100%;background:#0f172a;border:1.5px solid rgba(255,255,255,.15);border-radius:10px;padding:14px 16px;color:#f1f5f9;font-size:16px;transition:border-color .15s"
            onfocus="this.style.borderColor='#f97316'" onblur="this.style.borderColor='rgba(255,255,255,.15)'" />
        </div>
        <button id="loginBtn"
          style="width:100%;background:linear-gradient(135deg,#f97316,#ea580c);color:#fff;font-weight:700;font-size:.95rem;padding:14px;border-radius:10px;border:none;box-shadow:0 4px 14px rgba(249,115,22,.3);transition:opacity .15s">
          Sign In
        </button>
      </div>

      <div id="msg" class="mt-4 text-sm text-center" style="display:none"></div>

      <!-- Back link -->
      <div class="text-center mt-5">
        <a href="/" class="text-xs" style="color:#475569;text-decoration:none">â† Back to Homepage</a>
      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);

    const ROLES = {
      merchant:   { emoji: 'ğŸª', label: 'Merchant Portal',      badge: 'rgba(16,185,129,.15)',  badgeColor: '#34d399', badgeBorder: 'rgba(16,185,129,.3)' },
      company:    { emoji: 'ğŸš›', label: 'Fleet Company Portal', badge: 'rgba(59,130,246,.15)',  badgeColor: '#60a5fa', badgeBorder: 'rgba(59,130,246,.3)' },
      superadmin: { emoji: 'ğŸ›¡ï¸', label: 'Super Admin Portal',  badge: 'rgba(168,85,247,.15)', badgeColor: '#c084fc', badgeBorder: 'rgba(168,85,247,.3)' },
    };
    let activeRole = 'merchant';

    // Pre-select role from URL query param (?role=company etc)
    const urlRole = new URLSearchParams(location.search).get('role');
    if (urlRole && ROLES[urlRole]) {
      activeRole = urlRole;
      document.querySelectorAll('.tab-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.role === urlRole);
      });
      applyRoleBadge(urlRole);
    }

    function applyRoleBadge(role) {
      const r = ROLES[role];
      const badge = $('roleBadge');
      badge.style.background = r.badge;
      badge.style.color = r.badgeColor;
      badge.style.borderColor = r.badgeBorder;
      $('roleEmoji').textContent = r.emoji;
      $('roleLabel').textContent = r.label;
    }

    function switchTab(btn) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeRole = btn.dataset.role;
      applyRoleBadge(activeRole);
      $('msg').style.display = 'none';
    }

    function showMsg(text, isError) {
      const el = $('msg');
      el.textContent = text;
      el.style.display = 'block';
      el.style.color = isError ? '#f87171' : '#34d399';
    }

    $('loginBtn').onclick = doLogin;
    $('password').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
    $('username').addEventListener('keydown', e => { if (e.key === 'Enter') $('password').focus(); });

    async function doLogin() {
      $('msg').style.display = 'none';
      const u = $('username').value.trim();
      const p = $('password').value;
      if (!u || !p) { showMsg('Username and password required', true); return; }

      const btn = $('loginBtn');
      btn.disabled = true;
      btn.textContent = 'Signing in...';
      btn.style.opacity = '0.7';

      try {
        const r = await fetch('/api/login', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({username: u, password: p})
        });
        if (!r.ok) {
          const t = await r.text();
          let detail = 'Login failed';
          try { detail = JSON.parse(t).detail || t; } catch(e) { detail = t; }
          showMsg(detail, true);
          btn.disabled = false; btn.textContent = 'Sign In'; btn.style.opacity = '1';
          return;
        }
        const data = await r.json();
        const role = (data.role || '').toLowerCase();
        showMsg('Welcome! Redirecting...', false);
        setTimeout(() => {
          if (role === 'company_admin') window.location.href = '/company';
          else if (role === 'superadmin')   window.location.href = '/superadmin';
          else if (role === 'merchant')     window.location.href = '/merchant';
          else window.location.href = '/superadmin';
        }, 500);
      } catch(e) {
        showMsg(e.message, true);
        btn.disabled = false; btn.textContent = 'Sign In'; btn.style.opacity = '1';
      }
    }
  </script>
</body>
</html>
