<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ANOMAAH ‚Äî Sign In</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Inter',system-ui,-apple-system,sans-serif;-webkit-font-smoothing:antialiased}
    input{-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:16px}
    button{min-height:44px}
  </style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen px-4 py-6">
  <div class="w-full max-w-sm">
    <!-- Logo -->
    <div class="text-center mb-6">
      <div class="w-14 h-14 bg-slate-900 rounded-2xl flex items-center justify-center mx-auto mb-3">
        <span class="text-white font-bold text-xl">P</span>
      </div>
      <h1 class="text-2xl font-bold text-slate-900 tracking-wide">ANOMAAH</h1>
      <p class="text-sm text-slate-500 mt-1">Sign in to your dashboard</p>
    </div>

    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-sm border border-slate-200">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1.5">Username</label>
          <input id="username" placeholder="Enter username" class="w-full border border-slate-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition" />
        </div>
        <div>
          <label class="block text-sm font-medium text-slate-700 mb-1.5">Password</label>
          <input id="password" type="password" placeholder="Enter password" class="w-full border border-slate-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition" />
        </div>
        <button id="loginBtn" class="w-full bg-slate-900 text-white px-6 py-3 rounded-lg hover:bg-slate-800 active:bg-slate-700 transition font-medium text-sm">
          Sign In
        </button>
      </div>
      <div id="msg" class="mt-4 text-sm text-center hidden"></div>

      <!-- Hint -->
      <div class="mt-5 pt-4 border-t border-slate-100">
        <p class="text-xs text-slate-400 text-center mb-2">Demo credentials</p>
        <div class="space-y-1.5 text-xs text-slate-500">
          <div class="flex justify-between items-center"><span>üõ°Ô∏è Superadmin</span><span class="font-mono text-slate-600">superadmin / admin123</span></div>
          <div class="flex justify-between items-center"><span>üè¢ Rider Company</span><span class="font-mono text-slate-600">demo_company / company123</span></div>
        </div>
        <p class="text-[11px] text-slate-400 text-center mt-3">You'll be redirected automatically based on your role</p>
      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);

    function showMsg(text, isError) {
      const el = $('msg');
      el.textContent = text;
      el.className = 'mt-4 text-sm text-center ' + (isError ? 'text-red-600' : 'text-emerald-600');
    }

    $('loginBtn').onclick = doLogin;
    $('password').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin() });
    $('username').addEventListener('keydown', e => { if (e.key === 'Enter') $('password').focus() });

    async function doLogin() {
      $('msg').className = 'mt-4 text-sm text-center hidden';
      const u = $('username').value.trim();
      const p = $('password').value;
      if (!u || !p) { showMsg('Username and password required', true); return }

      $('loginBtn').disabled = true;
      $('loginBtn').textContent = 'Signing in...';

      try {
        const r = await fetch('/api/login', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({username: u, password: p})
        });
        if (!r.ok) {
          const t = await r.text();
          let detail = 'Login failed';
          try { detail = JSON.parse(t).detail || t } catch(e) { detail = t }
          showMsg(detail, true);
          $('loginBtn').disabled = false;
          $('loginBtn').textContent = 'Sign In';
          return;
        }
        const data = await r.json();
        const role = (data.role || '').toLowerCase();

        // Auto-redirect based on actual role from server
        if (role === 'company_admin') {
          showMsg('Welcome! Redirecting to Fleet Dashboard...', false);
          setTimeout(() => { window.location.href = '/company'; }, 500);
        } else if (role === 'superadmin') {
          showMsg('Welcome! Redirecting to Admin Dashboard...', false);
          setTimeout(() => { window.location.href = '/superadmin'; }, 500);
        } else if (role === 'merchant') {
          showMsg('Welcome! Redirecting to Merchant Dashboard...', false);
          setTimeout(() => { window.location.href = '/merchant'; }, 500);
        } else {
          showMsg('Signed in as ' + (data.username || u), false);
          setTimeout(() => { window.location.href = '/superadmin'; }, 500);
        }
      } catch(e) {
        showMsg(e.message, true);
        $('loginBtn').disabled = false;
        $('loginBtn').textContent = 'Sign In';
      }
    }
  </script>
</body>
</html>
